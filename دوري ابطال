from kivy.app import App
from kivy.uix.boxlayout import BoxLayout
from kivy.uix.label import Label
from kivy.uix.button import Button
from kivy.uix.scrollview import ScrollView
from kivy.uix.gridlayout import GridLayout
from kivy.uix.carousel import Carousel
from kivy.uix.image import Image
from kivy.uix.tabbedpanel import TabbedPanel, TabbedPanelItem
from kivy.clock import Clock
from kivy.graphics import Color, Rectangle
from kivy.core.text import LabelBase
import requests
import json
from datetime import datetime
import threading

# ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ
try:
    LabelBase.register(name='Arabic', fn_regular='fonts/arial.ttf')
except:
    pass

class ChampionsLeagueApp(App):
    def build(self):
        self.title = "Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ Ø£ÙˆØ±ÙˆØ¨Ø§ ğŸ†"
        self.data_manager = DataManager()
        
        # Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        self.main_layout = BoxLayout(orientation='vertical', spacing=10, padding=10)
        self.main_layout.canvas.before.clear()
        with self.main_layout.canvas.before:
            Color(0.96, 0.96, 0.96, 1)  # Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø©
            Rectangle(pos=self.main_layout.pos, size=self.main_layout.size)
        
        self.create_header()
        self.create_stats_bar()
        self.create_tabs()
        
        # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
        Clock.schedule_once(lambda dt: self.load_data(), 1)
        
        return self.main_layout
    
    def create_header(self):
        # Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        header = BoxLayout(size_hint=(1, 0.1), padding=10)
        header.canvas.before.clear()
        with header.canvas.before:
            Color(0, 0.27, 0.68, 1)  # Ø£Ø²Ø±Ù‚ Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
            Rectangle(pos=header.pos, size=header.size)
        
        title = Label(
            text='Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ Ø£ÙˆØ±ÙˆØ¨Ø§ ğŸ†',
            font_size='20sp',
            bold=True,
            color=(1, 1, 1, 1),
            font_name='Arabic'
        )
        header.add_widget(title)
        
        refresh_btn = Button(
            text='ğŸ”„',
            size_hint=(0.2, 1),
            background_color=(0, 0.27, 0.68, 1),
            on_press=self.refresh_data
        )
        header.add_widget(refresh_btn)
        
        self.main_layout.add_widget(header)
    
    def create_stats_bar(self):
        # Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        stats_layout = BoxLayout(size_hint=(1, 0.08), spacing=10)
        
        stats_data = [
            ('16', 'Ø§Ù„ÙØ±Ù‚'),
            ('45', 'Ù…Ø¨Ø§Ø±Ø§Ø©'),
            ('128', 'Ù‡Ø¯Ù'),
            ('8', 'Ø£Ø³Ø¨ÙˆØ¹')
        ]
        
        for value, label in stats_data:
            stat_box = BoxLayout(orientation='vertical')
            stat_box.canvas.before.clear()
            with stat_box.canvas.before:
                Color(1, 1, 1, 1)
                Rectangle(pos=stat_box.pos, size=stat_box.size)
            
            value_label = Label(
                text=value,
                font_size='16sp',
                bold=True,
                color=(0, 0.27, 0.68, 1),
                font_name='Arabic'
            )
            label_label = Label(
                text=label,
                font_size='12sp',
                color=(0.5, 0.5, 0.5, 1),
                font_name='Arabic'
            )
            
            stat_box.add_widget(value_label)
            stat_box.add_widget(label_label)
            stats_layout.add_widget(stat_box)
        
        self.main_layout.add_widget(stats_layout)
    
    def create_tabs(self):
        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        self.tabs = TabbedPanel(
            size_hint=(1, 0.82),
            tab_pos='top',
            do_default_tab=False
        )
        
        # ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
        matches_tab = TabbedPanelItem(text='Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª âš½')
        self.matches_content = ScrollView()
        self.matches_layout = GridLayout(cols=1, spacing=10, size_hint_y=None)
        self.matches_layout.bind(minimum_height=self.matches_layout.setter('height'))
        self.matches_content.add_widget(self.matches_layout)
        matches_tab.add_widget(self.matches_content)
        
        # ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ±ØªÙŠØ¨
        standings_tab = TabbedPanelItem(text='Ø§Ù„ØªØ±ØªÙŠØ¨ ğŸ“Š')
        self.standings_content = ScrollView()
        self.standings_layout = GridLayout(cols=1, spacing=5, size_hint_y=None)
        self.standings_layout.bind(minimum_height=self.standings_layout.setter('height'))
        self.standings_content.add_widget(self.standings_layout)
        standings_tab.add_widget(self.standings_content)
        
        # ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
        news_tab = TabbedPanelItem(text='Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ğŸ“°')
        self.news_content = ScrollView()
        self.news_layout = GridLayout(cols=1, spacing=10, size_hint_y=None)
        self.news_layout.bind(minimum_height=self.news_layout.setter('height'))
        self.news_content.add_widget(self.news_layout)
        news_tab.add_widget(self.news_content)
        
        # ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª
        events_tab = TabbedPanelItem(text='Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª ğŸ¯')
        self.events_content = ScrollView()
        self.events_layout = GridLayout(cols=1, spacing=10, size_hint_y=None)
        self.events_layout.bind(minimum_height=self.events_layout.setter('height'))
        self.events_content.add_widget(self.events_layout)
        events_tab.add_widget(self.events_content)
        
        self.tabs.add_widget(matches_tab)
        self.tabs.add_widget(standings_tab)
        self.tabs.add_widget(news_tab)
        self.tabs.add_widget(events_tab)
        
        self.main_layout.add_widget(self.tabs)
    
    def load_data(self):
        # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø®ÙŠØ· Ù…Ù†ÙØµÙ„
        threading.Thread(target=self._load_data_thread).start()
    
    def _load_data_thread(self):
        try:
            # Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
            matches_data = self.data_manager.get_live_matches()
            standings_data = self.data_manager.get_standings()
            news_data = self.data_manager.get_news()
            events_data = self.data_manager.get_events()
            
            # ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙŠ Ø§Ù„Ø®ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            Clock.schedule_once(lambda dt: self.update_ui(
                matches_data, standings_data, news_data, events_data
            ), 0)
            
        except Exception as e:
            Clock.schedule_once(lambda dt: self.show_error(str(e)), 0)
    
    def update_ui(self, matches, standings, news, events):
        # ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
        self.matches_layout.clear_widgets()
        for match in matches:
            self.matches_layout.add_widget(self.create_match_card(match))
        
        # ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ±ØªÙŠØ¨
        self.standings_layout.clear_widgets()
        self.standings_layout.add_widget(self.create_standings_header())
        for team in standings:
            self.standings_layout.add_widget(self.create_team_row(team))
        
        # ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
        self.news_layout.clear_widgets()
        for news_item in news:
            self.news_layout.add_widget(self.create_news_card(news_item))
        
        # ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª
        self.events_layout.clear_widgets()
        for event in events:
            self.events_layout.add_widget(self.create_event_card(event))
    
    def create_match_card(self, match):
        card = BoxLayout(
            orientation='vertical',
            size_hint_y=None,
            height=120,
            padding=10,
            spacing=5
        )
        card.canvas.before.clear()
        with card.canvas.before:
            Color(1, 1, 1, 1)
            Rectangle(pos=card.pos, size=card.size)
        
        # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
        match_info = BoxLayout(size_hint=(1, 0.6))
        
        team1 = Label(
            text=match['team1'],
            font_size='14sp',
            bold=True,
            font_name='Arabic'
        )
        
        score = Label(
            text=match['score'],
            font_size='18sp',
            bold=True,
            color=(0.8, 0, 0, 1)
        )
        
        team2 = Label(
            text=match['team2'],
            font_size='14sp',
            bold=True,
            font_name='Arabic'
        )
        
        match_info.add_widget(team1)
        match_info.add_widget(score)
        match_info.add_widget(team2)
        
        # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
        details = BoxLayout(size_hint=(1, 0.4))
        
        stage = Label(
            text=match['stage'],
            font_size='12sp',
            color=(0.5, 0.5, 0.5, 1),
            font_name='Arabic'
        )
        
        time = Label(
            text=f"{match['date']} - {match['time']}",
            font_size='12sp',
            color=(0.5, 0.5, 0.5, 1),
            font_name='Arabic'
        )
        
        details.add_widget(stage)
        details.add_widget(time)
        
        card.add_widget(match_info)
        card.add_widget(details)
        
        return card
    
    def create_standings_header(self):
        header = BoxLayout(
            size_hint_y=None,
            height=40,
            padding=10
        )
        header.canvas.before.clear()
        with header.canvas.before:
            Color(0, 0.27, 0.68, 1)
            Rectangle(pos=header.pos, size=header.size)
        
        headers = ['Ø§Ù„ØªØ±ØªÙŠØ¨', 'Ø§Ù„ÙØ±ÙŠÙ‚', 'Ù†', 'Ù', 'Øª', 'Ø®', 'Ù†Ù‚Ø§Ø·']
        for text in headers:
            header.add_widget(Label(
                text=text,
                font_size='12sp',
                bold=True,
                color=(1, 1, 1, 1),
                font_name='Arabic'
            ))
        
        return header
    
    def create_team_row(self, team):
        row = BoxLayout(
            size_hint_y=None,
            height=35,
            padding=10
        )
        row.canvas.before.clear()
        with row.canvas.before:
            Color(0.95, 0.95, 0.95, 1) if team['rank'] % 2 == 0 else Color(1, 1, 1, 1)
            Rectangle(pos=row.pos, size=row.size)
        
        data = [
            str(team['rank']),
            team['name'],
            str(team['played']),
            str(team['won']),
            str(team['drawn']),
            str(team['lost']),
            str(team['points'])
        ]
        
        for text in data:
            row.add_widget(Label(
                text=text,
                font_size='12sp',
                font_name='Arabic'
            ))
        
        return row
    
    def create_news_card(self, news_item):
        card = BoxLayout(
            orientation='vertical',
            size_hint_y=None,
            height=180,
            padding=15,
            spacing=8
        )
        card.canvas.before.clear()
        with card.canvas.before:
            Color(1, 1, 1, 1)
            Rectangle(pos=card.pos, size=card.size)
        
        # Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±
        title = Label(
            text=news_item['title'],
            font_size='16sp',
            bold=True,
            size_hint_y=None,
            height=40,
            text_size=(None, None),
            halign='right',
            font_name='Arabic'
        )
        
        # Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø±
        content = Label(
            text=news_item['content'],
            font_size='12sp',
            size_hint_y=None,
            height=80,
            text_size=(None, None),
            halign='right',
            color=(0.3, 0.3, 0.3, 1),
            font_name='Arabic'
        )
        
        # ØªÙØ§Ø¹Ù„Ø§Øª
        interactions = BoxLayout(size_hint_y=None, height=30)
        
        likes = Label(
            text=f"ğŸ‘ {news_item['likes']}",
            font_size='10sp',
            font_name='Arabic'
        )
        
        comments = Label(
            text=f"ğŸ’¬ {news_item['comments']}",
            font_size='10sp',
            font_name='Arabic'
        )
        
        shares = Label(
            text=f"â†—ï¸ {news_item['shares']}",
            font_size='10sp',
            font_name='Arabic'
        )
        
        date = Label(
            text=news_item['date'],
            font_size='10sp',
            color=(0.5, 0.5, 0.5, 1),
            font_name='Arabic'
        )
        
        interactions.add_widget(date)
        interactions.add_widget(shares)
        interactions.add_widget(comments)
        interactions.add_widget(likes)
        
        card.add_widget(title)
        card.add_widget(content)
        card.add_widget(interactions)
        
        return card
    
    def create_event_card(self, event):
        card = BoxLayout(
            orientation='vertical',
            size_hint_y=None,
            height=80,
            padding=15,
            spacing=5
        )
        card.canvas.before.clear()
        with card.canvas.before:
            Color(1, 1, 1, 1)
            Rectangle(pos=card.pos, size=card.size)
        
        title = Label(
            text=event['title'],
            font_size='16sp',
            bold=True,
            font_name='Arabic'
        )
        
        time = Label(
            text=f"{event['date']} - {event['time']}",
            font_size='12sp',
            color=(0.5, 0.5, 0.5, 1),
            font_name='Arabic'
        )
        
        card.add_widget(title)
        card.add_widget(time)
        
        return card
    
    def refresh_data(self, instance):
        self.load_data()
    
    def show_error(self, error_msg):
        print(f"Error: {error_msg}")

class DataManager:
    def __init__(self):
        self.base_url = "https://api.football-data.org/v4"
        self.api_key = "YOUR_API_KEY"  # Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Ù…Ù† football-data.org
    
    def get_live_matches(self):
        # Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† API)
        return [
            {
                'team1': 'Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯',
                'team2': 'Ù…Ø§Ù†Ø´Ø³ØªØ± Ø³ÙŠØªÙŠ', 
                'score': '3-2',
                'date': '2024-04-09',
                'time': '21:00',
                'stage': 'Ø±Ø¨Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ'
            },
            {
                'team1': 'Ø¨Ø§ÙŠØ±Ù† Ù…ÙŠÙˆÙ†Ø®',
                'team2': 'Ø£Ø±Ø³Ù†Ø§Ù„',
                'score': '2-2', 
                'date': '2024-04-10',
                'time': '21:00',
                'stage': 'Ø±Ø¨Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ'
            }
        ]
    
    def get_standings(self):
        return [
            {'rank': 1, 'name': 'Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯', 'played': 6, 'won': 5, 'drawn': 1, 'lost': 0, 'points': 16},
            {'rank': 2, 'name': 'Ù…Ø§Ù†Ø´Ø³ØªØ± Ø³ÙŠØªÙŠ', 'played': 6, 'won': 4, 'drawn': 2, 'lost': 0, 'points': 14},
            {'rank': 3, 'name': 'Ø¨Ø§ÙŠØ±Ù† Ù…ÙŠÙˆÙ†Ø®', 'played': 6, 'won': 4, 'drawn': 1, 'lost': 1, 'points': 13},
        ]
    
    def get_news(self):
        return [
            {
                'title': 'Ø¥ØµØ§Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ‡Ø² ØµÙÙˆÙ Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯',
                'content': 'ØªØ¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ Ù„Ø¥ØµØ§Ø¨Ø© Ø¹Ø¶ÙˆÙŠØ© ØªØ¨Ø¹Ø¯Ù‡ Ø¹Ù† Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ Ù„Ù…Ø¯Ø© 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ù‚Ø¨Ù„ Ù…ÙˆØ§Ø¬Ù‡Ø© Ù…Ø§Ù†Ø´Ø³ØªØ± Ø³ÙŠØªÙŠ.',
                'likes': '1.2K',
                'comments': '245',
                'shares': '89',
                'date': '2024-04-08'
            },
            {
                'title': 'Ù‡Ø¯Ø§Ù Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„',
                'content': 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ù‡Ø§Ø¬Ù… Ø§Ù„Ù†Ø±ÙˆÙŠØ¬ÙŠ Ù‡Ø¯ÙÙ‡ Ø§Ù„Ø¹Ø§Ø´Ø± ÙÙŠ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© Ù„ÙŠØµØ¨Ø­ Ø§Ù„Ù‡Ø¯Ø§Ù Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ³Ù….',
                'likes': '2.1K', 
                'comments': '356',
                'shares': '124',
                'date': '2024-04-07'
            }
        ]
    
    def get_events(self):
        return [
            {'title': 'Ù‚Ø±Ø¹Ø© Ù†ØµÙ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', 'date': '2024-04-15', 'time': '19:00'},
            {'title': 'Ù…Ù‡Ø±Ø¬Ø§Ù† Ø§Ù„Ø¬Ù…Ø§Ù‡ÙŠØ±', 'date': '2024-04-20', 'time': '16:00'},
            {'title': 'Ø­ÙÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²', 'date': '2024-05-10', 'time': '20:00'}
        ]

if __name__ == '__main__':
    ChampionsLeagueApp().run()
